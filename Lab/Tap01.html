<!DOCTYPE html>
<html>
<head>
<meta chaset="utf-8"/>
<meta name="description" content="見て下さい、この大きな蟹" />
<meta name="viewport" content="width=device-width"/>
<title>Tap-01</title>
<style>
body, html
{
	position: relative;
}

.Output
{
	margin: 2em;
}
</style>
<script src="../Prime16.js"></script>
</head>
<body>
<h1>Tap-01</h1>
<p>タップにならしむ</p>

<div id="Main" style="position: relative; "></div>
<p id="Output"></p>
<p id="Log"></p>

<script>

function log( msg )
{
	e_id( "Log" ).innerHTML += ht_plain( msg + "\n" ); 
}

var AppPane = function( com )
{
	var e = enew( "div", com );
	
	var cont = enew
	(
		"div", e, null,
		{
			height: "300px",
			border: "1px solid #555",
			position: "relative"
		}
	);
	
	var x_bar = enew
	(
		"div", cont, null,
		{
			position: "absolute",
			width: "0",
			height: "100%",
			borderRight: "1px dotted #666",
			left: "10px"
		}
	);
	
	var y_bar = enew
	(
		"div", cont, null,
		{
			position: "absolute",
			width: "100%",
			height: "0",
			borderBottom: "1px dotted #666",
			top: "10px"
		}
	);
	
	var tou = has_touches;
	cont.addEventListener( tou ? "touchstart" : "mousedown",  tou ? t_start : m_down );
	cont.addEventListener( tou ? "touchmove"  : "mousemove",  tou ? t_start : m_move );
	cont.addEventListener( tou ? "touchend"   : "mouseup"  ,  tou ? t_start : m_leave );
	cont.addEventListener( tou ? "touchcancel": "mouseleave", tou ? t_start : m_leave );
	
	var in_drag = false;
	function m_down( ev )
	{
		in_drag = true;
		set_bar( "mousedown", ev.offsetX, ev.offsetY );
	}
	
	function m_move( ev )
	{
		if( in_drag )  set_bar( "mousemove", ev.offsetX, ev.offsetY );
	}
	
	function m_leave( ev )
	{
		in_drag = false;
		set_bar( "mouseleave", ev.offsetX, ev.offsetY, true );
	}
	
	function t_start( ev )
	{
		ev.preventDefault();
		var touch = ev.changedTouches[ 0 ];
		var bou = cont.getBoundingClientRect();
		
		var x = touch.pageX - bou.left + window.pageXOffset;
		var y = touch.pageY - bou.top + window.pageYOffset;
		
		set_bar( ev.type, x, y );
	}
	
	var e_mon = enew_t( "p", e, "monitor" );
	
	function set_bar( m, x, y, u )
	{
		e_mon.innerHTML = ht_plain( [ m, x, y ].join( " " ) );
		
		if( ! u )
		{
			x_bar.style.left = x + "px";
			y_bar.style.top = y + "px";
		}
	}
	
}

var has_touches = ( "TouchEvent" in window );
log( "has_touches ? : " + has_touches );
log( "new AppPane" );
new AppPane( e_id( "Main" ) );

</script>


</body>
</html>
